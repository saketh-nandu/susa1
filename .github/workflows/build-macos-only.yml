name: Build macOS Installers Only

on:
  workflow_dispatch:

jobs:
  build-macos-complete:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Build CLI
        run: |
          cd cpp-core
          clang++ -std=c++17 -O2 -arch x86_64 -arch arm64 main.cpp -o susa 2>/dev/null || \
          clang++ -std=c++17 -O2 -arch x86_64 main.cpp -o susa
          chmod +x susa
          ./susa --version || echo "CLI built"
      
      - name: Build IDE
        run: |
          cd susa-ide/remix-of-susa-studio-ide-main
          npm install --legacy-peer-deps
          npm run dist:mac
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: List IDE Build Output
        run: |
          echo "=== Checking IDE build output ==="
          ls -lah susa-ide/remix-of-susa-studio-ide-main/dist-electron/ || echo "No dist-electron folder"
          find susa-ide/remix-of-susa-studio-ide-main/dist-electron -name "*.app" -o -name "*.dmg" 2>/dev/null || echo "No app or dmg found"
      
      - name: Create PKG Installers
        run: |
          # Copy logo
          cp 'susa logo.png' susa-logo.png 2>/dev/null || echo "Logo not found"
          
          # Create professional welcome page with full branding
          cat > welcome.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8"/>
            <style>
              body { 
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
                padding: 30px; 
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
              }
              .container {
                background: white;
                color: #1f2937;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
              }
              .logo { text-align: center; margin: 20px 0; }
              .logo img { width: 150px; height: 150px; }
              h1 { 
                color: #2563eb; 
                text-align: center; 
                font-size: 32px;
                margin: 20px 0;
              }
              .tagline {
                text-align: center;
                font-size: 18px;
                color: #6b7280;
                margin-bottom: 30px;
              }
              .features { 
                background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
                padding: 20px; 
                border-radius: 8px; 
                margin: 20px 0;
                border-left: 4px solid #2563eb;
              }
              .features h3 {
                color: #2563eb;
                margin-top: 0;
              }
              .features ul { 
                margin: 15px 0;
                padding-left: 20px;
              }
              .features li { 
                margin: 8px 0;
                font-size: 15px;
              }
              .highlight {
                background: #fef3c7;
                padding: 15px;
                border-radius: 8px;
                margin: 20px 0;
                border-left: 4px solid #f59e0b;
              }
              .footer {
                text-align: center;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 2px solid #e5e7eb;
              }
              .footer a {
                color: #2563eb;
                text-decoration: none;
                font-weight: bold;
                font-size: 16px;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <div class="logo"><img src="susa-logo.png" alt="SUSA Logo"/></div>
              <h1>Welcome to SUSA v1.0.0</h1>
              <p class="tagline"><strong>The AI-Powered Programming Language with English-Like Syntax</strong></p>
              
              <div class="features">
                <h3>âœ¨ Complete Feature Set - 40 Language Features:</h3>
                <ul>
                  <li>âœ… <strong>Object-Oriented Programming</strong> - Classes, Inheritance, Polymorphism</li>
                  <li>âœ… <strong>Functional Programming</strong> - Lambda Functions, Higher-Order Functions</li>
                  <li>âœ… <strong>Async/Await</strong> - Modern Asynchronous Programming</li>
                  <li>âœ… <strong>Generators & Yield</strong> - Efficient Data Streaming</li>
                  <li>âœ… <strong>Error Handling</strong> - Try/Catch/Finally Blocks</li>
                  <li>âœ… <strong>9 Built-in Modules</strong> - 290+ Ready-to-Use Functions</li>
                  <li>âœ… <strong>Fast C++ Interpreter</strong> - High Performance Execution</li>
                  <li>âœ… <strong>Cross-Platform</strong> - Windows, macOS, Linux</li>
                </ul>
              </div>
              
              <div class="highlight">
                <strong>ðŸŽ¯ Perfect For:</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                  <li>Beginners learning programming with readable syntax</li>
                  <li>Professionals building real-world applications</li>
                  <li>Educators teaching programming concepts</li>
                  <li>Rapid prototyping and scripting</li>
                </ul>
              </div>
              
              <div class="footer">
                <p><strong>Official Website:</strong> <a href="https://susastudio.online">susastudio.online</a></p>
                <p style="color: #6b7280; font-size: 14px; margin-top: 10px;">
                  Â© 2026 SUSA Development Team | MIT License
                </p>
              </div>
            </div>
          </body>
          </html>
          EOF
          
          # Create professional conclusion page
          cat > conclusion.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8"/>
            <style>
              body { 
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
                padding: 30px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
              }
              .container {
                background: white;
                color: #1f2937;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
              }
              .logo { text-align: center; margin: 20px 0; }
              .logo img { width: 120px; height: 120px; }
              h1 { 
                color: #16a34a; 
                text-align: center;
                font-size: 36px;
                margin: 20px 0;
              }
              .success { 
                background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
                padding: 20px; 
                border-radius: 8px; 
                margin: 20px 0; 
                border-left: 4px solid #16a34a;
                text-align: center;
              }
              .success p {
                font-size: 18px;
                margin: 10px 0;
              }
              .commands { 
                background: #1f2937; 
                color: #10b981; 
                padding: 20px; 
                border-radius: 8px; 
                font-family: 'Monaco', 'Courier New', monospace;
                margin: 20px 0;
                font-size: 16px;
              }
              .commands p {
                margin: 8px 0;
              }
              .next-steps { 
                background: #f3f4f6; 
                padding: 20px; 
                border-radius: 8px; 
                margin: 20px 0;
              }
              .next-steps h3 {
                color: #2563eb;
                margin-top: 0;
              }
              .next-steps ul {
                padding-left: 20px;
              }
              .next-steps li {
                margin: 10px 0;
                font-size: 15px;
              }
              .footer {
                text-align: center;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 2px solid #e5e7eb;
                color: #6b7280;
              }
              .footer strong {
                color: #1f2937;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <div class="logo"><img src="susa-logo.png" alt="SUSA Logo"/></div>
              <h1>ðŸŽ‰ Installation Complete!</h1>
              
              <div class="success">
                <p><strong>âœ… SUSA has been successfully installed on your Mac!</strong></p>
                <p>You're ready to start coding in SUSA!</p>
              </div>
              
              <div class="next-steps">
                <h3>ðŸš€ Quick Start Guide:</h3>
                <p><strong>1. Open Terminal and verify installation:</strong></p>
                <div class="commands">
                  <p>$ susa --version</p>
                  <p>SUSA v1.0.0</p>
                </div>
                
                <p><strong>2. Create your first SUSA program:</strong></p>
                <div class="commands">
                  <p>$ echo 'print("Hello from SUSA!")' > hello.susa</p>
                  <p>$ susa hello.susa</p>
                </div>
                
                <p><strong>3. Explore example programs:</strong></p>
                <div class="commands">
                  <p>$ cd /usr/local/share/susa/examples</p>
                  <p>$ susa welcome.susa</p>
                </div>
              </div>
              
              <div class="next-steps">
                <h3>ðŸ“š Learn More:</h3>
                <ul>
                  <li><strong>Documentation:</strong> <a href="https://susastudio.online/docs">susastudio.online/docs</a></li>
                  <li><strong>Tutorials:</strong> <a href="https://susastudio.online/tutorials">susastudio.online/tutorials</a></li>
                  <li><strong>Examples:</strong> /usr/local/share/susa/examples/</li>
                  <li><strong>Modules:</strong> /usr/local/share/susa/modules/</li>
                  <li><strong>Community:</strong> <a href="https://susastudio.online/community">susastudio.online/community</a></li>
                </ul>
              </div>
              
              <div class="footer">
                <p><strong>Thank you for choosing SUSA!</strong></p>
                <p>Happy coding! ðŸ’»âœ¨</p>
                <p style="margin-top: 15px; font-size: 14px;">
                  Â© 2026 SUSA Development Team | <a href="https://susastudio.online">susastudio.online</a>
                </p>
              </div>
            </div>
          </body>
          </html>
          EOF
          
          # Create professional license file
          cat > license.txt << 'EOF'
          ================================================================================
                                    SUSA v1.0.0
                          The AI-Powered Programming Language
                              https://susastudio.online
          ================================================================================

          MIT License

          Copyright (c) 2026 SUSA Development Team

          Permission is hereby granted, free of charge, to any person obtaining a copy
          of this software and associated documentation files (the "Software"), to deal
          in the Software without restriction, including without limitation the rights
          to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the Software is
          furnished to do so, subject to the following conditions:

          The above copyright notice and this permission notice shall be included in all
          copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
          IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
          FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
          AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
          LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
          OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
          SOFTWARE.

          ================================================================================
                                    FEATURES INCLUDED
          ================================================================================

          âœ“ 40 Complete Language Features
          âœ“ Object-Oriented Programming (Classes, Inheritance, Polymorphism)
          âœ“ Functional Programming (Lambda, Higher-Order Functions)
          âœ“ Async/Await Support
          âœ“ Generators and Yield
          âœ“ Error Handling (Try/Catch/Finally)
          âœ“ 9 Built-in Modules with 290+ Functions
          âœ“ Fast C++ Interpreter
          âœ“ Cross-Platform Support

          ================================================================================
          EOF
          
          # 1. CLI PKG
          echo "=== Building CLI PKG ==="
          mkdir -p susa-cli-pkg/usr/local/bin
          mkdir -p susa-cli-pkg/usr/local/share/susa/{modules,examples}
          cp cpp-core/susa susa-cli-pkg/usr/local/bin/
          [ -d "modules" ] && cp -r modules/* susa-cli-pkg/usr/local/share/susa/modules/ 2>/dev/null || true
          [ -d "examples" ] && cp -r examples/* susa-cli-pkg/usr/local/share/susa/examples/ 2>/dev/null || true
          
          pkgbuild --root susa-cli-pkg --identifier com.susa.cli --version 1.0.0 --install-location / SUSA-CLI-component.pkg
          
          cat > distribution-cli.xml << 'EOF'
          <?xml version="1.0"?>
          <installer-gui-script minSpecVersion="1">
              <title>SUSA CLI v1.0.0</title>
              <organization>com.susa</organization>
              <welcome file="welcome.html"/>
              <license file="license.txt"/>
              <conclusion file="conclusion.html"/>
              <background file="susa-logo.png" alignment="bottomleft" scaling="none"/>
              <pkg-ref id="com.susa.cli"/>
              <choices-outline><line choice="com.susa.cli"/></choices-outline>
              <choice id="com.susa.cli" title="SUSA CLI"><pkg-ref id="com.susa.cli"/></choice>
              <pkg-ref id="com.susa.cli">SUSA-CLI-component.pkg</pkg-ref>
          </installer-gui-script>
          EOF
          
          productbuild --distribution distribution-cli.xml --resources . SUSA-CLI-1.0.0.pkg
          ls -lh SUSA-CLI-1.0.0.pkg
          
          # 2. IDE - Find and copy the .app bundle
          echo "=== Building IDE PKG ==="
          IDE_APP=$(find susa-ide/remix-of-susa-studio-ide-main/dist-electron -name "*.app" -type d | head -1)
          
          if [ -n "$IDE_APP" ] && [ -d "$IDE_APP" ]; then
            echo "Found IDE app: $IDE_APP"
            mkdir -p susa-ide-pkg/Applications
            cp -R "$IDE_APP" susa-ide-pkg/Applications/
            
            pkgbuild --root susa-ide-pkg --identifier com.susa.ide --version 1.0.0 --install-location / SUSA-IDE-component.pkg
            
            cat > distribution-ide.xml << 'EOF'
          <?xml version="1.0"?>
          <installer-gui-script minSpecVersion="1">
              <title>SUSA IDE v1.0.0</title>
              <organization>com.susa</organization>
              <welcome file="welcome.html"/>
              <license file="license.txt"/>
              <conclusion file="conclusion.html"/>
              <background file="susa-logo.png" alignment="bottomleft" scaling="none"/>
              <pkg-ref id="com.susa.ide"/>
              <choices-outline><line choice="com.susa.ide"/></choices-outline>
              <choice id="com.susa.ide" title="SUSA IDE"><pkg-ref id="com.susa.ide"/></choice>
              <pkg-ref id="com.susa.ide">SUSA-IDE-component.pkg</pkg-ref>
          </installer-gui-script>
          EOF
            
            productbuild --distribution distribution-ide.xml --resources . SUSA-IDE-1.0.0.pkg
            ls -lh SUSA-IDE-1.0.0.pkg
          else
            echo "ERROR: IDE app not found!"
          fi
          
          # Also copy DMG if exists
          DMG_FILE=$(find susa-ide/remix-of-susa-studio-ide-main/dist-electron -name "*.dmg" | head -1)
          if [ -n "$DMG_FILE" ] && [ -f "$DMG_FILE" ]; then
            cp "$DMG_FILE" SUSA-IDE-1.0.0.dmg
            ls -lh SUSA-IDE-1.0.0.dmg
          fi
          
          # 3. Complete PKG (CLI + IDE)
          echo "=== Building Complete PKG ==="
          mkdir -p susa-complete-pkg/usr/local/bin
          mkdir -p susa-complete-pkg/usr/local/share/susa/{modules,examples}
          mkdir -p susa-complete-pkg/Applications
          
          cp cpp-core/susa susa-complete-pkg/usr/local/bin/
          [ -d "modules" ] && cp -r modules/* susa-complete-pkg/usr/local/share/susa/modules/ 2>/dev/null || true
          [ -d "examples" ] && cp -r examples/* susa-complete-pkg/usr/local/share/susa/examples/ 2>/dev/null || true
          
          if [ -n "$IDE_APP" ] && [ -d "$IDE_APP" ]; then
            cp -R "$IDE_APP" susa-complete-pkg/Applications/
          fi
          
          pkgbuild --root susa-complete-pkg --identifier com.susa.complete --version 1.0.0 --install-location / SUSA-Complete-component.pkg
          
          cat > distribution-complete.xml << 'EOF'
          <?xml version="1.0"?>
          <installer-gui-script minSpecVersion="1">
              <title>SUSA Complete v1.0.0</title>
              <organization>com.susa</organization>
              <welcome file="welcome.html"/>
              <license file="license.txt"/>
              <conclusion file="conclusion.html"/>
              <background file="susa-logo.png" alignment="bottomleft" scaling="none"/>
              <pkg-ref id="com.susa.complete"/>
              <choices-outline><line choice="com.susa.complete"/></choices-outline>
              <choice id="com.susa.complete" title="SUSA Complete (CLI + IDE)"><pkg-ref id="com.susa.complete"/></choice>
              <pkg-ref id="com.susa.complete">SUSA-Complete-component.pkg</pkg-ref>
          </installer-gui-script>
          EOF
          
          productbuild --distribution distribution-complete.xml --resources . SUSA-Complete-1.0.0.pkg
          ls -lh SUSA-Complete-1.0.0.pkg
      
      - name: Upload Installers
        uses: actions/upload-artifact@v4
        with:
          name: macos-installers
          path: |
            SUSA-CLI-1.0.0.pkg
            SUSA-IDE-1.0.0.pkg
            SUSA-IDE-1.0.0.dmg
            SUSA-Complete-1.0.0.pkg
