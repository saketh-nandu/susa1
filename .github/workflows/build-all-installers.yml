name: Build All SUSA Installers (CLI, IDE, Complete)

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'
  workflow_dispatch:

env:
  SUSA_VERSION: "1.0.0"

jobs:
  # ============================================
  # WINDOWS INSTALLERS (3 total)
  # ============================================
  
  build-windows-cli:
    name: Windows CLI Installer
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW64
          update: true
          install: mingw-w64-x86_64-gcc
      
      - name: Build SUSA Compiler
        shell: msys2 {0}
        run: |
          cd cpp-core
          g++ -std=c++17 -Wall -O2 -static -o susa.exe main.cpp
      
      - name: Create LICENSE.txt
        run: |
          @"
          MIT License
          
          Copyright (c) 2026 SUSA Team
          
          Permission is hereby granted, free of charge, to any person obtaining a copy
          of this software and associated documentation files (the "Software"), to deal
          in the Software without restriction, including without limitation the rights
          to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the Software is
          furnished to do so, subject to the following conditions:
          
          The above copyright notice and this permission notice shall be included in all
          copies or substantial portions of the Software.
          
          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
          IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
          FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
          "@ | Out-File -FilePath LICENSE.txt -Encoding ASCII

      - name: Create NSIS Installer
        run: |
          $nsi = @'
          !define PRODUCT_NAME "SUSA CLI"
          !define PRODUCT_VERSION "${{ env.SUSA_VERSION }}"
          !include "MUI2.nsh"
          !define MUI_ABORTWARNING
          !insertmacro MUI_PAGE_WELCOME
          !insertmacro MUI_PAGE_LICENSE "LICENSE.txt"
          !insertmacro MUI_PAGE_DIRECTORY
          !insertmacro MUI_PAGE_INSTFILES
          !insertmacro MUI_PAGE_FINISH
          !insertmacro MUI_UNPAGE_CONFIRM
          !insertmacro MUI_UNPAGE_INSTFILES
          !insertmacro MUI_LANGUAGE "English"
          Name "${PRODUCT_NAME}"
          OutFile "SUSA-CLI-Setup.exe"
          InstallDir "$PROGRAMFILES64\SUSA"
          RequestExecutionLevel admin
          Function .onInit
            nsExec::Exec 'taskkill /F /IM susa.exe /T'
          FunctionEnd
          Section "Install"
            SetOutPath "$INSTDIR"
            File "cpp-core\susa.exe"
            File "LICENSE.txt"
            WriteUninstaller "$INSTDIR\uninstall-cli.exe"
            EnVar::SetHKLM
            EnVar::AddValue "PATH" "$INSTDIR"
            WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA-CLI" "DisplayName" "SUSA CLI"
            WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA-CLI" "UninstallString" "$INSTDIR\uninstall-cli.exe"
          SectionEnd
          Function un.onInit
            nsExec::Exec 'taskkill /F /IM susa.exe /T'
          FunctionEnd
          Section "Uninstall"
            Delete "$INSTDIR\susa.exe"
            Delete "$INSTDIR\LICENSE.txt"
            Delete "$INSTDIR\uninstall-cli.exe"
            RMDir "$INSTDIR"
            EnVar::SetHKLM
            EnVar::DeleteValue "PATH" "$INSTDIR"
            DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA-CLI"
          SectionEnd
          '@
          $nsi | Out-File -FilePath "installer.nsi" -Encoding ASCII
      
      - uses: joncloud/makensis-action@v4
        with:
          script-file: installer.nsi
      
      - uses: actions/upload-artifact@v4
        with:
          name: windows-cli
          path: SUSA-CLI-Setup.exe

  build-windows-ide:
    name: Windows IDE Installer
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create placeholder IDE
        run: echo "SUSA IDE" > susa-ide.exe

      - name: Create LICENSE.txt
        run: |
          @"
          MIT License
          
          Copyright (c) 2026 SUSA Team
          "@ | Out-File -FilePath LICENSE.txt -Encoding ASCII
      
      - name: Create NSIS Installer
        run: |
          $nsi = @'
          !define PRODUCT_NAME "SUSA Desktop IDE"
          !define PRODUCT_VERSION "${{ env.SUSA_VERSION }}"
          !include "MUI2.nsh"
          !define MUI_ABORTWARNING
          !insertmacro MUI_PAGE_WELCOME
          !insertmacro MUI_PAGE_LICENSE "LICENSE.txt"
          !insertmacro MUI_PAGE_DIRECTORY
          !insertmacro MUI_PAGE_INSTFILES
          !insertmacro MUI_PAGE_FINISH
          !insertmacro MUI_UNPAGE_CONFIRM
          !insertmacro MUI_UNPAGE_INSTFILES
          !insertmacro MUI_LANGUAGE "English"
          Name "${PRODUCT_NAME}"
          OutFile "SUSA-IDE-Setup.exe"
          InstallDir "$PROGRAMFILES64\SUSA IDE"
          RequestExecutionLevel admin
          Function .onInit
            nsExec::Exec 'taskkill /F /IM susa-ide.exe /T'
          FunctionEnd
          Section "Install"
            SetOutPath "$INSTDIR"
            File "susa-ide.exe"
            File "LICENSE.txt"
            WriteUninstaller "$INSTDIR\uninstall.exe"
            CreateShortCut "$DESKTOP\SUSA IDE.lnk" "$INSTDIR\susa-ide.exe"
            CreateDirectory "$SMPROGRAMS\SUSA"
            CreateShortCut "$SMPROGRAMS\SUSA\SUSA IDE.lnk" "$INSTDIR\susa-ide.exe"
            WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA-IDE" "DisplayName" "SUSA IDE"
            WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA-IDE" "UninstallString" "$INSTDIR\uninstall.exe"
          SectionEnd
          Function un.onInit
            nsExec::Exec 'taskkill /F /IM susa-ide.exe /T'
          FunctionEnd
          Section "Uninstall"
            Delete "$INSTDIR\susa-ide.exe"
            Delete "$INSTDIR\LICENSE.txt"
            Delete "$INSTDIR\uninstall.exe"
            Delete "$DESKTOP\SUSA IDE.lnk"
            Delete "$SMPROGRAMS\SUSA\SUSA IDE.lnk"
            RMDir "$SMPROGRAMS\SUSA"
            RMDir "$INSTDIR"
            DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA-IDE"
          SectionEnd
          '@
          $nsi | Out-File -FilePath "installer.nsi" -Encoding ASCII
      
      - uses: joncloud/makensis-action@v4
        with:
          script-file: installer.nsi
      
      - uses: actions/upload-artifact@v4
        with:
          name: windows-ide
          path: SUSA-IDE-Setup.exe


  build-windows-complete:
    name: Windows Complete Installer
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW64
          update: true
          install: mingw-w64-x86_64-gcc
      
      - name: Build SUSA Compiler
        shell: msys2 {0}
        run: |
          cd cpp-core
          g++ -std=c++17 -Wall -O2 -static -o susa.exe main.cpp
      
      - name: Create placeholder IDE
        run: echo "SUSA IDE" > susa-ide.exe
      
      - name: Create LICENSE.txt
        run: |
          @"
          MIT License
          
          Copyright (c) 2026 SUSA Team
          "@ | Out-File -FilePath LICENSE.txt -Encoding ASCII
      
      - name: Create NSIS Installer
        run: |
          $nsi = @'
          !define PRODUCT_NAME "SUSA Complete"
          !define PRODUCT_VERSION "${{ env.SUSA_VERSION }}"
          !include "MUI2.nsh"
          !define MUI_ABORTWARNING
          !insertmacro MUI_PAGE_WELCOME
          !insertmacro MUI_PAGE_LICENSE "LICENSE.txt"
          !insertmacro MUI_PAGE_DIRECTORY
          !insertmacro MUI_PAGE_INSTFILES
          !insertmacro MUI_PAGE_FINISH
          !insertmacro MUI_UNPAGE_CONFIRM
          !insertmacro MUI_UNPAGE_INSTFILES
          !insertmacro MUI_LANGUAGE "English"
          Name "${PRODUCT_NAME}"
          OutFile "SUSA-Complete-Setup.exe"
          InstallDir "$PROGRAMFILES64\SUSA"
          RequestExecutionLevel admin
          Function .onInit
            nsExec::Exec 'taskkill /F /IM susa.exe /T'
            nsExec::Exec 'taskkill /F /IM susa-ide.exe /T'
          FunctionEnd
          Section "Install"
            SetOutPath "$INSTDIR"
            File "cpp-core\susa.exe"
            File "susa-ide.exe"
            File "LICENSE.txt"
            WriteUninstaller "$INSTDIR\uninstall.exe"
            EnVar::SetHKLM
            EnVar::AddValue "PATH" "$INSTDIR"
            CreateShortCut "$DESKTOP\SUSA IDE.lnk" "$INSTDIR\susa-ide.exe"
            CreateDirectory "$SMPROGRAMS\SUSA"
            CreateShortCut "$SMPROGRAMS\SUSA\SUSA IDE.lnk" "$INSTDIR\susa-ide.exe"
            WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA" "DisplayName" "SUSA Complete"
            WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA" "UninstallString" "$INSTDIR\uninstall.exe"
          SectionEnd
          Function un.onInit
            nsExec::Exec 'taskkill /F /IM susa.exe /T'
            nsExec::Exec 'taskkill /F /IM susa-ide.exe /T'
          FunctionEnd
          Section "Uninstall"
            Delete "$INSTDIR\susa.exe"
            Delete "$INSTDIR\susa-ide.exe"
            Delete "$INSTDIR\LICENSE.txt"
            Delete "$INSTDIR\uninstall.exe"
            Delete "$DESKTOP\SUSA IDE.lnk"
            Delete "$SMPROGRAMS\SUSA\SUSA IDE.lnk"
            RMDir "$SMPROGRAMS\SUSA"
            RMDir "$INSTDIR"
            EnVar::SetHKLM
            EnVar::DeleteValue "PATH" "$INSTDIR"
            DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\SUSA"
          SectionEnd
          '@
          $nsi | Out-File -FilePath "installer.nsi" -Encoding ASCII
      
      - uses: joncloud/makensis-action@v4
        with:
          script-file: installer.nsi
      
      - uses: actions/upload-artifact@v4
        with:
          name: windows-complete
          path: SUSA-Complete-Setup.exe


  # ============================================
  # MACOS INSTALLERS (3 total)
  # ============================================
  
  build-macos-cli:
    name: macOS CLI Installer
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build SUSA Compiler
        run: |
          cd cpp-core
          clang++ -std=c++17 -Wall -O2 -o susa main.cpp
          chmod +x susa
      
      - name: Create package structure
        run: |
          mkdir -p package/usr/local/bin
          cp cpp-core/susa package/usr/local/bin/
          chmod +x package/usr/local/bin/susa
      
      - name: Create scripts
        run: |
          mkdir -p scripts
          cat > scripts/preinstall << 'EOF'
          #!/bin/bash
          pkill -9 susa 2>/dev/null || true
          exit 0
          EOF
          cat > scripts/postinstall << 'EOF'
          #!/bin/bash
          echo 'export PATH="$PATH:/usr/local/bin"' >> "$HOME/.zshrc"
          echo 'export PATH="$PATH:/usr/local/bin"' >> "$HOME/.bash_profile"
          echo "‚úÖ SUSA CLI installed! Run 'susa --version'"
          exit 0
          EOF
          chmod +x scripts/*
      
      - name: Build PKG
        run: |
          pkgbuild --root package --identifier com.susa.cli --version ${{ env.SUSA_VERSION }} --scripts scripts --install-location / susa-cli.pkg
          productbuild --package susa-cli.pkg SUSA-CLI-${{ env.SUSA_VERSION }}.pkg
      
      - uses: actions/upload-artifact@v4
        with:
          name: macos-cli
          path: SUSA-CLI-${{ env.SUSA_VERSION }}.pkg

  build-macos-ide:
    name: macOS IDE Installer
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create placeholder IDE
        run: |
          mkdir -p SUSA-IDE.app/Contents/MacOS
          echo "#!/bin/bash" > SUSA-IDE.app/Contents/MacOS/susa-ide
          echo "echo 'SUSA IDE'" >> SUSA-IDE.app/Contents/MacOS/susa-ide
          chmod +x SUSA-IDE.app/Contents/MacOS/susa-ide
      
      - name: Create package structure
        run: |
          mkdir -p package/Applications
          cp -R SUSA-IDE.app package/Applications/
      
      - name: Create scripts
        run: |
          mkdir -p scripts
          cat > scripts/preinstall << 'EOF'
          #!/bin/bash
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          EOF
          cat > scripts/postinstall << 'EOF'
          #!/bin/bash
          echo "‚úÖ SUSA IDE installed in Applications folder!"
          exit 0
          EOF
          chmod +x scripts/*
      
      - name: Build PKG
        run: |
          pkgbuild --root package --identifier com.susa.ide --version ${{ env.SUSA_VERSION }} --scripts scripts --install-location / susa-ide.pkg
          productbuild --package susa-ide.pkg SUSA-IDE-${{ env.SUSA_VERSION }}.pkg
      
      - uses: actions/upload-artifact@v4
        with:
          name: macos-ide
          path: SUSA-IDE-${{ env.SUSA_VERSION }}.pkg


  build-macos-complete:
    name: macOS Complete Installer
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build SUSA Compiler
        run: |
          cd cpp-core
          clang++ -std=c++17 -Wall -O2 -o susa main.cpp
          chmod +x susa
      
      - name: Create placeholder IDE
        run: |
          mkdir -p SUSA-IDE.app/Contents/MacOS
          echo "#!/bin/bash" > SUSA-IDE.app/Contents/MacOS/susa-ide
          echo "echo 'SUSA IDE'" >> SUSA-IDE.app/Contents/MacOS/susa-ide
          chmod +x SUSA-IDE.app/Contents/MacOS/susa-ide
      
      - name: Create package structure
        run: |
          mkdir -p package/usr/local/bin package/Applications
          cp cpp-core/susa package/usr/local/bin/
          chmod +x package/usr/local/bin/susa
          cp -R SUSA-IDE.app package/Applications/
      
      - name: Create scripts
        run: |
          mkdir -p scripts
          cat > scripts/preinstall << 'EOF'
          #!/bin/bash
          pkill -9 susa 2>/dev/null || true
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          EOF
          cat > scripts/postinstall << 'EOF'
          #!/bin/bash
          echo 'export PATH="$PATH:/usr/local/bin"' >> "$HOME/.zshrc"
          echo 'export PATH="$PATH:/usr/local/bin"' >> "$HOME/.bash_profile"
          echo "‚úÖ SUSA Complete installed! CLI + IDE ready!"
          exit 0
          EOF
          chmod +x scripts/*
      
      - name: Build PKG
        run: |
          pkgbuild --root package --identifier com.susa.complete --version ${{ env.SUSA_VERSION }} --scripts scripts --install-location / susa-complete.pkg
          productbuild --package susa-complete.pkg SUSA-Complete-${{ env.SUSA_VERSION }}.pkg
      
      - uses: actions/upload-artifact@v4
        with:
          name: macos-complete
          path: SUSA-Complete-${{ env.SUSA_VERSION }}.pkg


  # ============================================
  # LINUX DEB INSTALLERS (3 total)
  # ============================================
  
  build-linux-cli-deb:
    name: Linux CLI DEB
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build SUSA Compiler
        run: |
          cd cpp-core
          g++ -std=c++17 -Wall -O2 -o susa main.cpp
          chmod +x susa
      
      - name: Create DEB package
        run: |
          mkdir -p susa-cli-deb/DEBIAN susa-cli-deb/usr/local/bin
          cp cpp-core/susa susa-cli-deb/usr/local/bin/
          chmod +x susa-cli-deb/usr/local/bin/susa
          cat > susa-cli-deb/DEBIAN/control << EOF
          Package: susa-cli
          Version: ${{ env.SUSA_VERSION }}
          Architecture: amd64
          Maintainer: SUSA Team <team@susastudio.online>
          Description: SUSA Programming Language CLI
          Homepage: https://susastudio.online
          EOF
          cat > susa-cli-deb/DEBIAN/preinst << 'EOF'
          #!/bin/bash
          pkill -9 susa 2>/dev/null || true
          exit 0
          EOF
          cat > susa-cli-deb/DEBIAN/postinst << 'EOF'
          #!/bin/bash
          echo 'export PATH="$PATH:/usr/local/bin"' > /etc/profile.d/susa.sh
          chmod +x /etc/profile.d/susa.sh
          echo "‚úÖ SUSA CLI installed!"
          exit 0
          EOF
          cat > susa-cli-deb/DEBIAN/prerm << 'EOF'
          #!/bin/bash
          pkill -9 susa 2>/dev/null || true
          exit 0
          EOF
          cat > susa-cli-deb/DEBIAN/postrm << 'EOF'
          #!/bin/bash
          rm -f /etc/profile.d/susa.sh
          exit 0
          EOF
          chmod +x susa-cli-deb/DEBIAN/*
          dpkg-deb --build susa-cli-deb
          mv susa-cli-deb.deb susa-cli_${{ env.SUSA_VERSION }}_amd64.deb
      
      - uses: actions/upload-artifact@v4
        with:
          name: linux-cli-deb
          path: susa-cli_${{ env.SUSA_VERSION }}_amd64.deb

  build-linux-ide-deb:
    name: Linux IDE DEB
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create placeholder IDE
        run: |
          echo "#!/bin/bash" > susa-ide
          echo "echo 'SUSA IDE'" >> susa-ide
          chmod +x susa-ide
      
      - name: Create DEB package
        run: |
          mkdir -p susa-ide-deb/DEBIAN susa-ide-deb/usr/local/bin susa-ide-deb/usr/share/applications
          cp susa-ide susa-ide-deb/usr/local/bin/
          cat > susa-ide-deb/usr/share/applications/susa-ide.desktop << EOF
          [Desktop Entry]
          Name=SUSA IDE
          Exec=/usr/local/bin/susa-ide
          Type=Application
          Categories=Development;
          EOF
          cat > susa-ide-deb/DEBIAN/control << EOF
          Package: susa-ide
          Version: ${{ env.SUSA_VERSION }}
          Architecture: amd64
          Maintainer: SUSA Team <team@susastudio.online>
          Description: SUSA Desktop IDE
          Homepage: https://susastudio.online
          EOF
          cat > susa-ide-deb/DEBIAN/preinst << 'EOF'
          #!/bin/bash
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          EOF
          cat > susa-ide-deb/DEBIAN/postinst << 'EOF'
          #!/bin/bash
          echo "‚úÖ SUSA IDE installed! Check Applications menu"
          exit 0
          EOF
          cat > susa-ide-deb/DEBIAN/prerm << 'EOF'
          #!/bin/bash
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          EOF
          chmod +x susa-ide-deb/DEBIAN/*
          dpkg-deb --build susa-ide-deb
          mv susa-ide-deb.deb susa-ide_${{ env.SUSA_VERSION }}_amd64.deb
      
      - uses: actions/upload-artifact@v4
        with:
          name: linux-ide-deb
          path: susa-ide_${{ env.SUSA_VERSION }}_amd64.deb


  build-linux-complete-deb:
    name: Linux Complete DEB
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build SUSA Compiler
        run: |
          cd cpp-core
          g++ -std=c++17 -Wall -O2 -o susa main.cpp
          chmod +x susa
      
      - name: Create placeholder IDE
        run: |
          echo "#!/bin/bash" > susa-ide
          echo "echo 'SUSA IDE'" >> susa-ide
          chmod +x susa-ide
      
      - name: Create DEB package
        run: |
          mkdir -p susa-complete-deb/DEBIAN susa-complete-deb/usr/local/bin susa-complete-deb/usr/share/applications
          cp cpp-core/susa susa-complete-deb/usr/local/bin/
          cp susa-ide susa-complete-deb/usr/local/bin/
          cat > susa-complete-deb/usr/share/applications/susa-ide.desktop << EOF
          [Desktop Entry]
          Name=SUSA IDE
          Exec=/usr/local/bin/susa-ide
          Type=Application
          Categories=Development;
          EOF
          cat > susa-complete-deb/DEBIAN/control << EOF
          Package: susa-complete
          Version: ${{ env.SUSA_VERSION }}
          Architecture: amd64
          Maintainer: SUSA Team <team@susastudio.online>
          Description: SUSA Complete (CLI + IDE)
          Homepage: https://susastudio.online
          EOF
          cat > susa-complete-deb/DEBIAN/preinst << 'EOF'
          #!/bin/bash
          pkill -9 susa 2>/dev/null || true
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          EOF
          cat > susa-complete-deb/DEBIAN/postinst << 'EOF'
          #!/bin/bash
          echo 'export PATH="$PATH:/usr/local/bin"' > /etc/profile.d/susa.sh
          chmod +x /etc/profile.d/susa.sh
          echo "‚úÖ SUSA Complete installed! CLI + IDE ready"
          exit 0
          EOF
          cat > susa-complete-deb/DEBIAN/prerm << 'EOF'
          #!/bin/bash
          pkill -9 susa 2>/dev/null || true
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          EOF
          cat > susa-complete-deb/DEBIAN/postrm << 'EOF'
          #!/bin/bash
          rm -f /etc/profile.d/susa.sh
          exit 0
          EOF
          chmod +x susa-complete-deb/DEBIAN/*
          dpkg-deb --build susa-complete-deb
          mv susa-complete-deb.deb susa-complete_${{ env.SUSA_VERSION }}_amd64.deb
      
      - uses: actions/upload-artifact@v4
        with:
          name: linux-complete-deb
          path: susa-complete_${{ env.SUSA_VERSION }}_amd64.deb


  # ============================================
  # LINUX RPM INSTALLERS (3 total)
  # ============================================
  
  build-linux-cli-rpm:
    name: Linux CLI RPM
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install RPM tools
        run: sudo apt-get update && sudo apt-get install -y rpm
      
      - name: Build SUSA Compiler
        run: |
          cd cpp-core
          g++ -std=c++17 -Wall -O2 -o susa main.cpp
          chmod +x susa
      
      - name: Create RPM package
        run: |
          mkdir -p ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}
          mkdir -p susa-cli-${{ env.SUSA_VERSION }}
          cp cpp-core/susa susa-cli-${{ env.SUSA_VERSION }}/
          tar czf ~/rpmbuild/SOURCES/susa-cli-${{ env.SUSA_VERSION }}.tar.gz susa-cli-${{ env.SUSA_VERSION }}
          cat > ~/rpmbuild/SPECS/susa-cli.spec << 'EOF'
          Name: susa-cli
          Version: ${{ env.SUSA_VERSION }}
          Release: 1
          Summary: SUSA Programming Language CLI
          License: MIT
          URL: https://susastudio.online
          Source0: susa-cli-%{version}.tar.gz
          %description
          SUSA Programming Language CLI
          %prep
          %setup -q
          %install
          mkdir -p %{buildroot}/usr/local/bin
          install -m 0755 susa %{buildroot}/usr/local/bin/susa
          %pre
          pkill -9 susa 2>/dev/null || true
          exit 0
          %post
          echo 'export PATH="$PATH:/usr/local/bin"' > /etc/profile.d/susa.sh
          chmod +x /etc/profile.d/susa.sh
          echo "‚úÖ SUSA CLI installed!"
          exit 0
          %preun
          pkill -9 susa 2>/dev/null || true
          exit 0
          %postun
          rm -f /etc/profile.d/susa.sh
          exit 0
          %files
          /usr/local/bin/susa
          EOF
          rpmbuild -ba ~/rpmbuild/SPECS/susa-cli.spec
          cp ~/rpmbuild/RPMS/x86_64/susa-cli-${{ env.SUSA_VERSION }}-1.*.rpm ./susa-cli-${{ env.SUSA_VERSION }}-1.x86_64.rpm
      
      - uses: actions/upload-artifact@v4
        with:
          name: linux-cli-rpm
          path: susa-cli-${{ env.SUSA_VERSION }}-1.x86_64.rpm

  build-linux-ide-rpm:
    name: Linux IDE RPM
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install RPM tools
        run: sudo apt-get update && sudo apt-get install -y rpm
      
      - name: Create placeholder IDE
        run: |
          echo "#!/bin/bash" > susa-ide
          echo "echo 'SUSA IDE'" >> susa-ide
          chmod +x susa-ide
      
      - name: Create RPM package
        run: |
          mkdir -p ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}
          mkdir -p susa-ide-${{ env.SUSA_VERSION }}
          cp susa-ide susa-ide-${{ env.SUSA_VERSION }}/
          tar czf ~/rpmbuild/SOURCES/susa-ide-${{ env.SUSA_VERSION }}.tar.gz susa-ide-${{ env.SUSA_VERSION }}
          cat > ~/rpmbuild/SPECS/susa-ide.spec << 'EOF'
          Name: susa-ide
          Version: ${{ env.SUSA_VERSION }}
          Release: 1
          Summary: SUSA Desktop IDE
          License: MIT
          URL: https://susastudio.online
          Source0: susa-ide-%{version}.tar.gz
          %description
          SUSA Desktop IDE
          %prep
          %setup -q
          %install
          mkdir -p %{buildroot}/usr/local/bin %{buildroot}/usr/share/applications
          install -m 0755 susa-ide %{buildroot}/usr/local/bin/susa-ide
          cat > %{buildroot}/usr/share/applications/susa-ide.desktop << EOFDESKTOP
          [Desktop Entry]
          Name=SUSA IDE
          Exec=/usr/local/bin/susa-ide
          Type=Application
          Categories=Development;
          EOFDESKTOP
          %pre
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          %post
          echo "‚úÖ SUSA IDE installed!"
          exit 0
          %preun
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          %files
          /usr/local/bin/susa-ide
          /usr/share/applications/susa-ide.desktop
          EOF
          rpmbuild -ba ~/rpmbuild/SPECS/susa-ide.spec
          cp ~/rpmbuild/RPMS/x86_64/susa-ide-${{ env.SUSA_VERSION }}-1.*.rpm ./susa-ide-${{ env.SUSA_VERSION }}-1.x86_64.rpm
      
      - uses: actions/upload-artifact@v4
        with:
          name: linux-ide-rpm
          path: susa-ide-${{ env.SUSA_VERSION }}-1.x86_64.rpm


  build-linux-complete-rpm:
    name: Linux Complete RPM
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install RPM tools
        run: sudo apt-get update && sudo apt-get install -y rpm
      
      - name: Build SUSA Compiler
        run: |
          cd cpp-core
          g++ -std=c++17 -Wall -O2 -o susa main.cpp
          chmod +x susa
      
      - name: Create placeholder IDE
        run: |
          echo "#!/bin/bash" > susa-ide
          echo "echo 'SUSA IDE'" >> susa-ide
          chmod +x susa-ide
      
      - name: Create RPM package
        run: |
          mkdir -p ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}
          mkdir -p susa-complete-${{ env.SUSA_VERSION }}
          cp cpp-core/susa susa-complete-${{ env.SUSA_VERSION }}/
          cp susa-ide susa-complete-${{ env.SUSA_VERSION }}/
          tar czf ~/rpmbuild/SOURCES/susa-complete-${{ env.SUSA_VERSION }}.tar.gz susa-complete-${{ env.SUSA_VERSION }}
          cat > ~/rpmbuild/SPECS/susa-complete.spec << 'EOF'
          Name: susa-complete
          Version: ${{ env.SUSA_VERSION }}
          Release: 1
          Summary: SUSA Complete (CLI + IDE)
          License: MIT
          URL: https://susastudio.online
          Source0: susa-complete-%{version}.tar.gz
          %description
          SUSA Complete includes CLI compiler and Desktop IDE
          %prep
          %setup -q
          %install
          mkdir -p %{buildroot}/usr/local/bin %{buildroot}/usr/share/applications
          install -m 0755 susa %{buildroot}/usr/local/bin/susa
          install -m 0755 susa-ide %{buildroot}/usr/local/bin/susa-ide
          cat > %{buildroot}/usr/share/applications/susa-ide.desktop << EOFDESKTOP
          [Desktop Entry]
          Name=SUSA IDE
          Exec=/usr/local/bin/susa-ide
          Type=Application
          Categories=Development;
          EOFDESKTOP
          %pre
          pkill -9 susa 2>/dev/null || true
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          %post
          echo 'export PATH="$PATH:/usr/local/bin"' > /etc/profile.d/susa.sh
          chmod +x /etc/profile.d/susa.sh
          echo "‚úÖ SUSA Complete installed! CLI + IDE ready"
          exit 0
          %preun
          pkill -9 susa 2>/dev/null || true
          pkill -9 susa-ide 2>/dev/null || true
          exit 0
          %postun
          rm -f /etc/profile.d/susa.sh
          exit 0
          %files
          /usr/local/bin/susa
          /usr/local/bin/susa-ide
          /usr/share/applications/susa-ide.desktop
          EOF
          rpmbuild -ba ~/rpmbuild/SPECS/susa-complete.spec
          cp ~/rpmbuild/RPMS/x86_64/susa-complete-${{ env.SUSA_VERSION }}-1.*.rpm ./susa-complete-${{ env.SUSA_VERSION }}-1.x86_64.rpm
      
      - uses: actions/upload-artifact@v4
        with:
          name: linux-complete-rpm
          path: susa-complete-${{ env.SUSA_VERSION }}-1.x86_64.rpm


  # ============================================
  # CREATE RELEASE WITH ALL 12 INSTALLERS
  # ============================================
  
  create-release:
    name: Create Release
    needs: 
      - build-windows-cli
      - build-windows-ide
      - build-windows-complete
      - build-macos-cli
      - build-macos-ide
      - build-macos-complete
      - build-linux-cli-deb
      - build-linux-ide-deb
      - build-linux-complete-deb
      - build-linux-cli-rpm
      - build-linux-ide-rpm
      - build-linux-complete-rpm
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')
    
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            windows-cli/*.exe
            windows-ide/*.exe
            windows-complete/*.exe
            macos-cli/*.pkg
            macos-ide/*.pkg
            macos-complete/*.pkg
            linux-cli-deb/*.deb
            linux-ide-deb/*.deb
            linux-complete-deb/*.deb
            linux-cli-rpm/*.rpm
            linux-ide-rpm/*.rpm
            linux-complete-rpm/*.rpm
          body: |
            ## üéâ SUSA Programming Language v${{ env.SUSA_VERSION }}
            
            Professional installers with MIT License agreement, automatic PATH configuration, desktop shortcuts, and process management.
            
            ---
            
            ### üì• Windows Installers
            
            | Package | Description | Features |
            |---------|-------------|----------|
            | **SUSA-CLI-Setup.exe** | CLI Compiler Only | ‚úÖ PATH auto-config |
            | **SUSA-IDE-Setup.exe** | Desktop IDE Only | ‚úÖ Desktop shortcut |
            | **SUSA-Complete-Setup.exe** | CLI + IDE | ‚úÖ PATH + Desktop shortcut |
            
            ---
            
            ### üçé macOS Installers
            
            | Package | Description | Features |
            |---------|-------------|----------|
            | **SUSA-CLI-${{ env.SUSA_VERSION }}.pkg** | CLI Compiler Only | ‚úÖ PATH auto-config |
            | **SUSA-IDE-${{ env.SUSA_VERSION }}.pkg** | Desktop IDE Only | ‚úÖ Applications folder |
            | **SUSA-Complete-${{ env.SUSA_VERSION }}.pkg** | CLI + IDE | ‚úÖ PATH + Applications |
            
            ---
            
            ### üêß Linux DEB Installers (Debian/Ubuntu)
            
            | Package | Description | Features |
            |---------|-------------|----------|
            | **susa-cli_${{ env.SUSA_VERSION }}_amd64.deb** | CLI Compiler Only | ‚úÖ PATH auto-config |
            | **susa-ide_${{ env.SUSA_VERSION }}_amd64.deb** | Desktop IDE Only | ‚úÖ Desktop entry |
            | **susa-complete_${{ env.SUSA_VERSION }}_amd64.deb** | CLI + IDE | ‚úÖ PATH + Desktop entry |
            
            ---
            
            ### üêß Linux RPM Installers (RedHat/Fedora/CentOS)
            
            | Package | Description | Features |
            |---------|-------------|----------|
            | **susa-cli-${{ env.SUSA_VERSION }}-1.x86_64.rpm** | CLI Compiler Only | ‚úÖ PATH auto-config |
            | **susa-ide-${{ env.SUSA_VERSION }}-1.x86_64.rpm** | Desktop IDE Only | ‚úÖ Desktop entry |
            | **susa-complete-${{ env.SUSA_VERSION }}-1.x86_64.rpm** | CLI + IDE | ‚úÖ PATH + Desktop entry |
            
            ---
            
            ### üöÄ Installation Instructions
            
            **Windows**: Double-click the `.exe` file and follow the wizard
            
            **macOS**: 
            ```bash
            sudo installer -pkg SUSA-[TYPE]-${{ env.SUSA_VERSION }}.pkg -target /
            ```
            
            **Linux DEB**:
            ```bash
            sudo dpkg -i susa-[type]_${{ env.SUSA_VERSION }}_amd64.deb
            ```
            
            **Linux RPM**:
            ```bash
            sudo rpm -i susa-[type]-${{ env.SUSA_VERSION }}-1.x86_64.rpm
            ```
            
            ---
            
            ### ‚ú® Features
            
            ‚úÖ MIT License agreement page
            ‚úÖ Custom installation directory
            ‚úÖ Automatic PATH configuration (CLI & Complete)
            ‚úÖ Desktop shortcuts (IDE & Complete)
            ‚úÖ Kills running processes before install/uninstall
            ‚úÖ Professional uninstaller
            ‚úÖ Complete cleanup on removal
            
            ---
            
            **Visit [susastudio.online](https://susastudio.online) for documentation and tutorials!**
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
